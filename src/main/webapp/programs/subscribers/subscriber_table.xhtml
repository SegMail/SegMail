<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:s2="http://seca2.jsf/custom"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:pass="http://xmlns.jcp.org/jsf/passthrough">
    <form jsf:id="FormSubscriberTable">
        <div class="block-head">

        </div>
        <div class="block-content">
            <div class="row">
                <div class="col-md-4">
                    <!--<input class="form-control" type="text" placeholder="Search for email"/>-->
                    <h:inputText styleClass="form-control" pass:placeholder="Search for email"
                                 value="#{FormSubscriberTable.emailSearch}"
                        >
                        <f:ajax event="keyup" listener="#{FormSubscriberTable.loadPage(1)}"
                                delay="1000" onevent="refresh"
                                render="@form"
                            >
                        </f:ajax>
                    </h:inputText>
                    
                </div>
                <div id="addSubscButtons" class="col-md-8" style="text-align: right">
                    <h:commandLink styleClass="btn btn-primary" pass:href="#import_subscriber_popup"
                                   pass:data-toggle="modal" value="Import Subscribers"
                                   >
                        <f:ajax render=":FormImportSubscribers" event="click" 
                                 onevent="refreshImport"
                                listener="#{FormImportSubscribers.setupImport()}"
                                >
                        </f:ajax>
                    </h:commandLink>
                    <h:commandLink styleClass="btn btn-info" pass:href="#add_subscriber_popup"
                                   pass:data-toggle="modal" value="Add Subscriber"
                                   style="margin-left: 5px"
                                   >
                        <f:ajax render=":FormAddSubscriber" event="click" 
                                onevent="refreshAddSubsc"
                                listener="#{FormImportSubscribers.setupImport()}"
                                >
                        </f:ajax>
                    </h:commandLink>
                </div>
            </div>
            <div class="pull-right">

            </div>
        </div>
        <div class="block-content np">
            <table jsf:id="subscriber_table" class="table table-condensed">
                <thead>
                    <tr>
                        <th>
                            <div class="checkbox">
                                <input type="checkbox" class="trigger-check"
                                       onclick="toggleCheckbox()"/>
                            </div>
                        </th>
                        <th>
                            Email
                        </th>
                        <th>Lists</th>
                        <th>Operations</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <c:forEach items="#{FormSubscriberTable.subscriberTable.keySet()}" var="subscriber">
                        <tr>
                            <td>
                                <div class="checkbox">
                                    <input type="checkbox" name="checkbox" class="checkbox"/>
                                </div>
                            </td>
                            <td>#{FormSubscriberTable.subscriberTable[subscriber]['segmail.entity.subscription.SubscriberAccount'].EMAIL}</td>
                            <td>
                                <ui:repeat value="#{FormSubscriberTable.subscriberTable[subscriber]['segmail.entity.subscription.Subscription']}"
                                           var="subscription" varStatus="status">
                                    <c:choose>
                                        <c:when test="#{status.index > 0}">
                                            &#44;
                                        </c:when>
                                    </c:choose>
                                    #{subscription.TARGET.OBJECT_NAME}
                                    
                                </ui:repeat>
                            </td>
                            <td>
                                <button class="btn btn-primary">
                                    <i class="fa fa-user"></i>
                                </button>
                                <button class="btn btn-danger">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </td>
                            <td>
                                #{FormSubscriberTable.subscriberTable[subscriber]['segmail.entity.subscription.SubscriberAccount'].SUBSCRIBER_STATUS}
                            </td>
                        </tr>
                    </c:forEach>
                </tbody>
            </table>
        </div>
        <div class="block-footer">
            <div class="row">
                <div class="col-md-12">
                    <ul class="pagination pull-right">
                        <li class="">
                            <h:commandLink value="&lt;&lt;" 
                                               action="#{FormSubscriberTable.loadPage(1)}"
                                               >
                                <f:ajax render="@form"
                                        >
                                </f:ajax>
                            </h:commandLink>
                        </li>
                        <ui:repeat id="pagination" value="#{FormSubscriberTable.pages}"
                                   var="i" 
                                   >
                            <li class="#{(i eq FormSubscriberTable.currentPage) ? 'active' : ''}">
                                <h:commandLink value="#{i}" 
                                               action="#{FormSubscriberTable.loadPage(i)}"
                                               >
                                    <f:ajax render="@form"
                                            >
                                    </f:ajax>
                                </h:commandLink>
                            </li>
                            
                        </ui:repeat>
                        <li class="">
                            <h:commandLink value="&gt;&gt;" 
                                               action="#{FormSubscriberTable.loadPage(FormSubscriberTable.totalPage)}"
                                               >
                                <f:ajax render="@form"
                                        >
                                </f:ajax>
                            </h:commandLink>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </form>
</html>