<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:s2="http://seca2.jsf/custom"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:pass="http://xmlns.jcp.org/jsf/passthrough">
    <form jsf:id="FormEditEmailActivity" prependId="false">
        <div class="row">
            <div class="col-md-6">
                <div jsf:id="editor-panel" pass:id="editor-panel" class="block">
                    <div class="block-content">
                        <div class="form-group">
                            <label>
                                Subject:
                            </label>
                            <input type="text" class="form-control"
                                   jsf:value="#{FormEditEmailActivity.editingActivity.ACTIVITY_NAME}"
                                   name="subject" 
                                   >
                            </input>
                        </div>
                        <div class="form-group">
                            <textarea id="editor" class="editor"
                                      jsf:value="#{FormEditEmailActivity.editingActivity.ACTIVITY_CONTENT}">
                            </textarea>
                            <textarea id="processedContent" hidden="true" jsf:value="#{FormEditEmailActivity.editingActivity.ACTIVITY_CONTENT_PROCESSED}" >
                            </textarea>
                        </div>
                        <div class="controls" >
                            <div class="row-form" style="margin-top: 10px">
                                <div class="col-md-3">
                                    <strong>Send in batchs of:</strong>
                                </div>
                                <div class="col-md-4">
                                    <input id="sendInBatch" type="number" style="" class="form-control"
                                           onchange="setSendInBatch('sendInBatch')"
                                           jsf:value="#{FormEditEmailActivity.editingSchedule.SEND_IN_BATCH}"
                                           placeholder="blank or 0 = send all"
                                           >
                                    </input>
                                </div>
                                <div class="col-md-5">
                                    <div class="form-group">
                                        <h:selectOneMenu style="width: 100%;"
                                                         styleClass="select2"
                                                         value="#{FormEditEmailActivity.editingSchedule.EVERY_HOUR}"
                                                         >
                                            <f:selectItem itemValue="6" itemLabel="Every 6 hours"></f:selectItem>
                                            <f:selectItem itemValue="12" itemLabel="Every 12 hours"></f:selectItem>
                                            <f:selectItem itemValue="24" itemLabel="Every 24 hours"></f:selectItem>
                                        </h:selectOneMenu>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="block-footer">
                        <div class="pull-left">
                            <a href="#{request.contextPath}/campaign/#{FormEditEmailActivity.editingCampaignId}" class="btn btn-default">Return without Saving</a>
                        </div>
                        <div class="pull-right">
                            <span id="saveResults" >

                            </span>
                            <button jsf:id="saveButton" pass:id="saveButton"
                                    class="btn btn-success"
                                >
                                <f:ajax listener="#{FormEditEmailActivity.saveAndContinue()}"
                                        event="click"
                                        onevent="onSave"
                                        render="editor-panel"
                                        execute="@form"
                                        >
                                </f:ajax>
                                <i class="fa fa-save"></i>
                                Save
                            </button>

                        </div>
                    </div>
                </div>

            </div>
            <div class="col-md-6">
                <div class="block">
                    <div class="block-content">
                        <h2>This is how your email will look like</h2>
                        <p>
                            It's a WYSIWYG editor on your left but you would miss out how the mail merge
                            tags will look like.
                        </p>
                    </div>
                </div>
                <div id="preview-panel" class="block">

                    <div class="block-content">
                        <div class="row">
                            <div id="preview" class="col-md-9" >
                            </div>
                            <div id="links" class="col-md-3" >
                            </div>
                            </div>
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript" >
            var web_service_endpoint = '#{request.contextPath}/WSCampaignActivityLink';
            var web_service_endpoint2 = '#{request.contextPath}/WSCampaignActivityMailMerge';
            var WSAutoresponderEndpoint = '#{request.contextPath}/WSAutoresponder';

            var mailmergeTagsSubscriber = [
                    <c:forEach items = "#{FormEditEmailActivity.listFields}" var = "field" >
                    '#{field.MAILMERGE_TAG}',
                    </c:forEach>
            ];
                    var mailmergeLinks = [
                            <c:forEach items = "#{FormEditEmailActivity.mailmergeLinkTags}" var = "link" >
                            '#{link.label()}',
                            </c:forEach>
                    ];
        </script>
    </form>
</html>