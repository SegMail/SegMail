<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:s2="http://seca2.jsf/custom"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite">
    <!--==========================
     demo.js  http://plugins.jquery.com/soap/ or https://github.com/doedje/jquery.soap
     part of the jQuery.soap distribution version: 1.6.0
     
     this file contains the javascript for the jQuery.soap demo
     ===========================-->
    <script>

        $(document).ready(function () {
            //global variables
            
            
            $("#slider").on("slidechange", function (event, ui) {
                //window.alert("Slider has been changed");
                var points = window.myLine.datasets[0].points;
                points.forEach(function (entry) {
                    entry.value = $("#slider").slider("value") - entry.value;
                });
                window.myLine.update();
            });
            $("#principalInput, #intRateInput, #numYearsInput").bind("change paste keyup", function () {
                //Send SOAP request
                var points = {
                    name : "points",
                    data : []
                };
                
                if(($("#principalInput").val() !== 0 &amp;&amp; $("#principalInput").val() !== "") &amp;&amp;
                   ($("#intRateInput").val() !== 0 &amp;&amp; $("#intRateInput").val() !== "") &amp;&amp;
                   ($("#numYearsInput").val() !== 0 &amp;&amp; $("#numYearsInput").val() !== "")){
                       var result = callSOAP(points);
                        $('#soapResult').text(points);
                        replotChart(points.data.return,window.myLine,true,[]);
                   }
                    
            });
            //$(".form")
            //        .delayedChange({
            //            delay : 5000
            //        })
            //        .on("delayedchange", function(){
            //    var callout = callSOAP();
            //    $('#soapRequest').text(callout);
            //});
            //var ns = 'ns2';

            //replots the chart with new dataset
            //var data : the dataset to be added, should be an array
            //var chart : the chart object
            //var append : a boolean to determine if the new dataset should replace 
            //
            function replotChart(newData,chart,append=true,options={}){
                
                //create new dataset
                //if not actual options is passed in, chart will take on default values?
                newDataset = (options.length === 0) ? chart.datasets[0] : options;
                //newDataset.data = newData;
                
                //determine X-axis
                var xDiv = newData.length; // number of divisions in the X-axis
                var newLabels = [];
                for(i in newData){
                    newLabels.push(i);
                }
                
                var data = {
                    labels : newLabels,
                    datasets: [
                        {
                            label: newDataset.label,
                            fillColor: newDataset.fillColor,
                            strokeColor: newDataset.strokeColor,
                            pointColor: newDataset.pointColor,
                            pointStrokeColor: newDataset.pointStrokeColor,
                            pointHighlightFill: newDataset.pointHighlightFill,
                            pointHighlightStroke: newDataset.pointHighlightStroke,
                            data: newData
                        }
                    ]
                }
                
                var ctx = document.getElementById("canvas").getContext("2d");
                
                chart = new Chart(ctx).Line(data, {
                    responsive: true
                });
                chart.update();
            }
        });

    </script>
    <script src="#{request.contextPath}/programs/chartjs/js/jquery.soap.js"></script>
    <script src="#{request.contextPath}/programs/chartjs/js/demo.js"></script>
    <script src="#{request.contextPath}/programs/chartjs/js/jquery.delayedchange.js"></script>
    <script src="#{request.contextPath}/programs/chartjs/js/xml2json.js"></script>
    <script src="#{request.contextPath}/programs/chartjs/js/oopjavascript.js"></script>
</html>