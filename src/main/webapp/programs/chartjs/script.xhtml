<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:s2="http://seca2.jsf/custom"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite">
    <!--==========================
     demo.js  http://plugins.jquery.com/soap/ or https://github.com/doedje/jquery.soap
     part of the jQuery.soap distribution version: 1.6.0
     
     this file contains the javascript for the jQuery.soap demo
     ===========================-->
    <script>

        $(document).ready(function () {
            $("#slider").on("slidechange", function (event, ui) {
                //window.alert("Slider has been changed");
                var points = window.myLine.datasets[0].points;
                points.forEach(function (entry) {
                    entry.value = $("#slider").slider("value") - entry.value;
                })
                window.myLine.update();
            });
            $("#principalInput, #intRateInput, #numYearsInput").bind("change paste keyup", function () {
                var callout = callSOAP();
                $('#soapRequest').text(callout);
            });
            function callSOAP() {
                return $.soap({
                    url: "#{ProgramChartJS.WEB_SERVICE_ENDPOINT}",
                    method: "outstandingLoanOverTime",
                    appendMethodToURL: 0,
                    //SOAPAction: 'outstandingLoanOverTime',
                    //soap12: $('#soap12').prop('checked'),
                    //async: $('#async').prop('checked'),
                    data: {
                        int: $('#intRateInput').val(),
                        n: $('#numYearsInput').val(),
                        p: $('#principalInput').val()
                    },
                    //wss: wss,
                    //HTTPHeaders: {
                        // Authentication: 'Basic ' + btoa('test:test')
                    //},
                    envAttributes: {
                        //'xmlns:test': 'http://www.test.org/'
                        'xmlns:SOAP-ENV': 'http://schemas.xmlsoap.org/soap/envelope/'
                    },
                    //SOAPHeader: '<test>"SOAPHeader"</test>',
                    namespaceQualifier: 'ns2',
                    namespaceURL: 'http://chartjs.program.seca2/',
                    noPrefix: 0, //You definitely need a namespace prepended to the operationName
                    //elementName: $('#elementName').val(),
                    //enableLogging: $('#enableLogging').prop('checked'),
                    //context: $('#feedback'),
                    
                    //My variables
                    HTTPHeaders : {
                        
                    },
                    
                    beforeSend: function (SOAPEnvelope) {
                        var xmlout = dom2html($.parseXML(SOAPEnvelope.toString()).firstChild);
                        $('#soapRequest').text(xmlout);
                    },
                    success: function (SOAPResponse) {

                        //	console.log(this)

                        $('#soapcall').html('Response: Success!');
                        //$('#soapcall').text(dom2html(SOAPResponse.toXML().firstChild));
                        $('#soapResult').text(dom2html(SOAPResponse.toXML().firstChild));
                    },
                    error: function (SOAPResponse) {

                        console.log(this)

                        $('#soapcall').text('Response: Error!').append(SOAPResponse.toString());
                        //$('#soapcall')
                    },
                    statusCode: {
                        404: function () {
                            console.log('404')
                        },
                        200: function () {
                            console.log('200')
                        }
                    }
                });
            }
        });

    </script>
    <script src="#{request.contextPath}/programs/chartjs/js/jquery.soap.js"></script>
    <script src="#{request.contextPath}/programs/chartjs/js/demo.js"></script>
</html>